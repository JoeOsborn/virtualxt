app-id: org.virtualxt.VirtualXT
runtime: org.freedesktop.Platform
runtime-version: '22.08'
sdk: org.freedesktop.Sdk
sdk-extensions:
  - org.freedesktop.Sdk.Extension.ziglang
command: virtualxt.freedos
finish-args:
  - --share=ipc
  - --socket=x11
  - --socket=pulseaudio
  - --filesystem=home
  - --filesystem=/media
  - --filesystem=/run/media
  - --device=all

modules:
  - name: SDL2
    buildsystem: autotools
    config-opts:
      - --disable-video-wayland
    cleanup:
      - /bin
      - /include
      - /lib/pkgconfig
      - /share
    sources:
      - type: archive
        url: https://github.com/libsdl-org/SDL/releases/download/release-2.24.1/SDL2-2.24.1.tar.gz
        sha256: bc121588b1105065598ce38078026a414c28ea95e66ed2adab4c44d80b309e1b

  - name: virtualxt
    buildsystem: simple
    build-commands:
      - /usr/lib/sdk/ziglang/zig build -Drelease-fast

      - install -Dm00755 build/bin/virtualxt $FLATPAK_DEST/bin/virtualxt
      - install -Dm00644 bios/pcxtbios.bin $FLATPAK_DEST/share/virtualxt/pcxtbios.bin
      - install -Dm00644 bios/glabios.bin $FLATPAK_DEST/share/virtualxt/glabios.bin
      - install -Dm00644 bios/vxtx.bin $FLATPAK_DEST/share/virtualxt/vxtx.bin
      - install -Dm00644 boot/freedos.img $FLATPAK_DEST/share/virtualxt/freedos.img
      - install -Dm00644 boot/freedos_hd.img $FLATPAK_DEST/share/virtualxt/freedos_hd.img

      - install -Dm00644 tools/icon/icon.png $FLATPAK_DEST/share/icons/hicolor/128x128/apps/$FLATPAK_ID.png
      
      - install -Dm00755 virtualxt.freedos $FLATPAK_DEST/bin/virtualxt.freedos
      - install -Dm00644 $FLATPAK_ID.desktop $FLATPAK_DEST/share/applications/$FLATPAK_ID.desktop
      - install -Dm00644 $FLATPAK_ID.appdata.xml $FLATPAK_DEST/share/appdata/$FLATPAK_ID.appdata.xml
    sources:
      - type: archive
        url: https://github.com/andreas-jonsson/virtualxt/archive/refs/heads/develop.tar.gz
        sha256: 4abb7ce9a4b9e51416ee48ab29c4caedcc25372e56c2a89f0b3c8a2ee41de799

      - type: file
        path: org.virtualxt.VirtualXT.appdata.xml

      - type: file
        path: org.virtualxt.VirtualXT.desktop

      - type: file
        path: virtualxt.freedos
